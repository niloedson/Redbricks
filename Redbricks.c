/**
 * @file Redbricks.c
 * @author Nilo Edson (niloedson.ms@gmail.com)
 * @brief 
 * @version 0.1
 * @date 2022-03-19
 * 
 * @copyright Copyright (c) 2022
 * 
 */

#include "Redbricks.h"

void redbricks_build(bmp_image * img)
{
    img->fileheader.bfType = BMP_FILETYPE_BM;
    img->fileheader.bfSize = 630;
    img->fileheader.bfReserved1 = 0;
    img->fileheader.bfReserved2 = 0;
    img->fileheader.bfOffBits = 118;

    img->info.bmiHeader.biSize = 40;
    img->info.bmiHeader.biWidth = 32;
    img->info.bmiHeader.biHeight = 32;
    img->info.bmiHeader.biPlanes = 1;
    img->info.bmiHeader.biBitCount = BMP_4_BITS;
    img->info.bmiHeader.biCompression = BMP_BI_RGB;
    img->info.bmiHeader.biSizeImage = 0;
    img->info.bmiHeader.biXPelsPerMeter = 0;
    img->info.bmiHeader.biYPelsPerMeter = 0;
    img->info.bmiHeader.biClrUsed = 0;
    img->info.bmiHeader.biClrImportant = 0;

    img->info.bmiColours = malloc(sizeof(bmp_rgbquad)*pow(2,img->info.bmiHeader.biBitCount));

    img->info.bmiColours[0].rgbBlue = 0x00; img->info.bmiColours[0].rgbGreen = 0x00; img->info.bmiColours[0].rgbRed = 0x00; img->info.bmiColours[0].rgbReserved = 0x00;
    img->info.bmiColours[1].rgbBlue = 0x00; img->info.bmiColours[1].rgbGreen = 0x00; img->info.bmiColours[1].rgbRed = 0x80; img->info.bmiColours[1].rgbReserved = 0x00;
    img->info.bmiColours[2].rgbBlue = 0x00; img->info.bmiColours[2].rgbGreen = 0x80; img->info.bmiColours[2].rgbRed = 0x00; img->info.bmiColours[2].rgbReserved = 0x00;
    img->info.bmiColours[3].rgbBlue = 0x00; img->info.bmiColours[3].rgbGreen = 0x80; img->info.bmiColours[3].rgbRed = 0x80; img->info.bmiColours[3].rgbReserved = 0x00;
    
    img->info.bmiColours[4].rgbBlue = 0x80; img->info.bmiColours[4].rgbGreen = 0x00; img->info.bmiColours[4].rgbRed = 0x00; img->info.bmiColours[4].rgbReserved = 0x00;
    img->info.bmiColours[5].rgbBlue = 0x80; img->info.bmiColours[5].rgbGreen = 0x00; img->info.bmiColours[5].rgbRed = 0x80; img->info.bmiColours[5].rgbReserved = 0x00;
    img->info.bmiColours[6].rgbBlue = 0x80; img->info.bmiColours[6].rgbGreen = 0x80; img->info.bmiColours[6].rgbRed = 0x00; img->info.bmiColours[6].rgbReserved = 0x00;
    img->info.bmiColours[7].rgbBlue = 0x80; img->info.bmiColours[7].rgbGreen = 0x80; img->info.bmiColours[7].rgbRed = 0x80; img->info.bmiColours[7].rgbReserved = 0x00;
    
    img->info.bmiColours[8].rgbBlue = 0xc0; img->info.bmiColours[8].rgbGreen = 0xc0; img->info.bmiColours[8].rgbRed = 0xc0; img->info.bmiColours[8].rgbReserved = 0x00;
    img->info.bmiColours[9].rgbBlue = 0x00; img->info.bmiColours[9].rgbGreen = 0x00; img->info.bmiColours[9].rgbRed = 0xff; img->info.bmiColours[9].rgbReserved = 0x00;
    img->info.bmiColours[10].rgbBlue = 0x00; img->info.bmiColours[10].rgbGreen = 0xff; img->info.bmiColours[10].rgbRed = 0x00; img->info.bmiColours[10].rgbReserved = 0x00;
    img->info.bmiColours[11].rgbBlue = 0x00; img->info.bmiColours[11].rgbGreen = 0xff; img->info.bmiColours[11].rgbRed = 0xff; img->info.bmiColours[11].rgbReserved = 0x00;
    
    img->info.bmiColours[12].rgbBlue = 0xff; img->info.bmiColours[12].rgbGreen = 0x00; img->info.bmiColours[12].rgbRed = 0x00; img->info.bmiColours[12].rgbReserved = 0x00;
    img->info.bmiColours[13].rgbBlue = 0xff; img->info.bmiColours[13].rgbGreen = 0x00; img->info.bmiColours[13].rgbRed = 0xff; img->info.bmiColours[13].rgbReserved = 0x00;
    img->info.bmiColours[14].rgbBlue = 0xff; img->info.bmiColours[14].rgbGreen = 0xff; img->info.bmiColours[14].rgbRed = 0x00; img->info.bmiColours[14].rgbReserved = 0x00;
    img->info.bmiColours[15].rgbBlue = 0xff; img->info.bmiColours[15].rgbGreen = 0xff; img->info.bmiColours[15].rgbRed = 0xff; img->info.bmiColours[15].rgbReserved = 0x00;

    unsigned char ciPixelArray[] = {
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x11, 0x11, 0x01, 0x19, 0x11, 0x01, 0x10, 0x10, 0x09, 0x09, 0x01, 0x09, 0x11, 0x11, 0x01, 0x90, 
        0x11, 0x01, 0x19, 0x09, 0x09, 0x91, 0x11, 0x10, 0x09, 0x11, 0x09, 0x11, 0x19, 0x10, 0x90, 0x11, 
        0x19, 0x01, 0x19, 0x19, 0x10, 0x10, 0x11, 0x10, 0x09, 0x01, 0x91, 0x10, 0x91, 0x09, 0x10, 0x10, 
        0x11, 0x10, 0x11, 0x91, 0x99, 0x11, 0x09, 0x90, 0x09, 0x91, 0x01, 0x11, 0x11, 0x11, 0x91, 0x10, 
        0x90, 0x99, 0x11, 0x11, 0x11, 0x11, 0x19, 0x00, 0x09, 0x01, 0x91, 0x01, 0x01, 0x19, 0x00, 0x99, 
        0x09, 0x19, 0x01, 0x00, 0x11, 0x90, 0x91, 0x10, 0x09, 0x01, 0x11, 0x99, 0x10, 0x01, 0x11, 0x11, 
        0x91, 0x11, 0x11, 0x19, 0x10, 0x11, 0x99, 0x10, 0x09, 0x10, 0x01, 0x11, 0x11, 0x11, 0x19, 0x10, 
        0x11, 0x09, 0x09, 0x10, 0x19, 0x10, 0x10, 0x10, 0x09, 0x01, 0x11, 0x19, 0x00, 0x01, 0x10, 0x19, 
        0x10, 0x11, 0x11, 0x01, 0x99, 0x01, 0x11, 0x90, 0x09, 0x19, 0x11, 0x91, 0x11, 0x91, 0x01, 0x11, 
        0x19, 0x10, 0x99, 0x00, 0x01, 0x19, 0x09, 0x10, 0x09, 0x19, 0x10, 0x91, 0x11, 0x01, 0x11, 0x11, 
        0x91, 0x01, 0x91, 0x19, 0x11, 0x00, 0x99, 0x90, 0x09, 0x01, 0x01, 0x99, 0x19, 0x01, 0x91, 0x10, 
        0x19, 0x91, 0x91, 0x09, 0x11, 0x99, 0x11, 0x10, 0x09, 0x91, 0x11, 0x10, 0x11, 0x91, 0x99, 0x10, 
        0x90, 0x11, 0x01, 0x11, 0x11, 0x19, 0x11, 0x90, 0x09, 0x11, 0x00, 0x19, 0x10, 0x11, 0x01, 0x11, 
        0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x09, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x99, 0x11, 0x11, 0x11, 0x19, 0x10, 0x19, 0x19, 0x11, 0x09, 0x10, 0x90, 0x91, 0x90, 0x91, 0x00, 
        0x91, 0x19, 0x19, 0x09, 0x01, 0x10, 0x09, 0x01, 0x11, 0x11, 0x91, 0x11, 0x11, 0x11, 0x10, 0x00, 
        0x91, 0x11, 0x01, 0x19, 0x10, 0x11, 0x10, 0x01, 0x01, 0x11, 0x90, 0x11, 0x11, 0x11, 0x91, 0x00, 
        0x99, 0x09, 0x19, 0x10, 0x11, 0x90, 0x09, 0x90, 0x91, 0x01, 0x19, 0x09, 0x91, 0x11, 0x01, 0x00, 
        0x90, 0x10, 0x19, 0x11, 0x00, 0x11, 0x11, 0x00, 0x10, 0x11, 0x01, 0x10, 0x11, 0x19, 0x11, 0x00, 
        0x90, 0x19, 0x10, 0x91, 0x01, 0x90, 0x19, 0x99, 0x00, 0x11, 0x91, 0x01, 0x11, 0x01, 0x91, 0x00, 
        0x99, 0x09, 0x09, 0x01, 0x10, 0x11, 0x91, 0x01, 0x10, 0x91, 0x99, 0x11, 0x10, 0x90, 0x91, 0x00, 
        0x91, 0x11, 0x00, 0x10, 0x11, 0x01, 0x10, 0x19, 0x19, 0x09, 0x10, 0x00, 0x99, 0x01, 0x01, 0x00, 
        0x91, 0x01, 0x19, 0x91, 0x19, 0x91, 0x11, 0x09, 0x10, 0x11, 0x00, 0x91, 0x00, 0x10, 0x90, 0x00, 
        0x99, 0x01, 0x11, 0x10, 0x09, 0x10, 0x10, 0x19, 0x09, 0x01, 0x91, 0x90, 0x11, 0x09, 0x11, 0x00, 
        0x90, 0x99, 0x11, 0x11, 0x11, 0x90, 0x19, 0x01, 0x19, 0x01, 0x91, 0x01, 0x01, 0x19, 0x09, 0x00, 
        0x91, 0x10, 0x11, 0x91, 0x99, 0x09, 0x09, 0x90, 0x11, 0x91, 0x01, 0x19, 0x11, 0x11, 0x91, 0x00, 
        0x91, 0x19, 0x01, 0x00, 0x11, 0x00, 0x91, 0x10, 0x11, 0x01, 0x11, 0x11, 0x10, 0x01, 0x11, 0x00, 
        0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0x90 
    };

    uint32_t datasize = img->info.bmiHeader.biWidth * img->info.bmiHeader.biHeight * img->info.bmiHeader.biBitCount / BMP_8_BITS;

    img->ciPixelArray = malloc(datasize);
    
    for (unsigned int i = 0; i < datasize; i++) {
        img->ciPixelArray[i] = (uint8_t) ciPixelArray[i];
    }
}

void redbricks_generate(bmp_image * img)
{
    bmp_save(img, "Redbricks.bmp");
}

void redbricks_print_fileheader(bmp_image * img)
{
    printf("\nBITMAPFILEHEADER structure: \n");
    uint8_t * archive = (uint8_t *) &(img->fileheader);
    uint8_t newline = 0;
    for (size_t i = 0; i < 14; i++) {
        if (newline >= 4) {
            printf("\n");
            newline = 0;
        }
        printf("%02hhx ", *(archive + i));
        newline++;
    }
    printf("\n\n");
}

void redbricks_print_infoheader(bmp_image * img)
{
    printf("\nBITMAPINFOHEADER structure: \n");
    uint8_t * archive = (uint8_t *) &(img->info.bmiHeader);
    uint8_t newline = 0;
    for (size_t i = 0; i < 40; i++) {
        if (newline >= 4) {
            printf("\n");
            newline = 0;
        }
        printf("%02hhx ", *(archive + i));
        newline++;
    }
    printf("\n\n");
}

void redbricks_print_colourpalette(bmp_image * img)
{
    printf("\nRGBQUAD structure: \n");
    uint8_t * archive = (uint8_t *) img->info.bmiColours;
    uint8_t newline = 0;
    for (size_t i = 0; i < 16*4; i++) {
        if (newline >= 4) {
            printf("\n");
            newline = 0;
        }
        printf("%02hhx ", *(archive + i));
        newline++;
    }
    printf("\n\n");
}

void redbricks_print_data(bmp_image * img)
{
    printf("\nPixel Array: \n");
    uint8_t * archive = (uint8_t *) img->ciPixelArray;
    uint8_t newline = 0;
    for (size_t i = 0; i < 512; i++) {
        if (newline >= 16) {
            printf("\n");
            newline = 0;
        }
        printf("%02hhx ", *(archive + i));
        newline++;
    }
    printf("\n\n");
}